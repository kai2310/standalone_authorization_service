<?xml version="1.0" encoding="UTF-8"?>

<project name="" default="build" basedir="../">

    <property name="version" value="undefined"/>
    <property name="release" value="manual"/>
    <property name="repository" value="dev"/>
    <property name="rpmExecutable" value="rpm"/>
    <property name="rsyncExecutable" value="/usr/sbin/rsync2repo.sh"/>

    <property name="target" location="target/rpm"/>
    <property name="temp" value="target/tmp"/>
    <property name="buildroot" location="${target}/INSTALL"/>
    <property name="appdir" value="${target}/INSTALL/usr/local/tomcat7"/>
    <property name="confDir" value="${target}/INSTALL/etc/trp"/>
    <property name="rpmBase" value="${target}/RPMS/noarch/"/>

    <target name="build">
        <delete dir="${target}" />
        <delete dir="${temp}"/>

        <mkdir dir="${target}/RPMS"/>
        <mkdir dir="${target}/SPECS"/>
        <mkdir dir="${target}/INSTALL"/>
        <mkdir dir="${target}/tmp"/>

        <mkdir dir="${target}/INSTALL/var/log/application/"/>
        <mkdir dir="${appdir}"/>
        <mkdir dir="${confDir}"/>


        <copy todir="${target}/SPECS" file="build/access-service.spec">
            <filterset>
                <filter token="VERSION" value="${version}"/>
                <filter token="RELEASE" value="${release}"/>
            </filterset>
        </copy>

        <copy todir="${confDir}" failonerror="false">
            <fileset dir="config/dev"/>
            <fileset dir="config/qa"/>
            <fileset dir="config/stage"/>
            <fileset dir="config/prod"/>
        </copy>

        <copy todir="${appdir}/webapps" file="target/access.war"/>

        <echo message="${buildroot}"/>

        <!--<rpm specfile="gateway-service.spec" topdir="${target}"
             command="-bb - -verbose - -buildroot=${buildroot}" failonerror="true"/>-->
        <exec executable="${rpmExecutable}" failonerror="true" dir="${target}">
            <arg value="--define"/>
            <arg value="_topdir ${target}"/>
            <arg value="-bb"/>
            <arg value="--verbose"/>
            <arg value="--buildroot=${buildroot}"/>
            <arg value="SPECS/access-service.spec"/>

        </exec>

       <!-- <exec executable="${rsyncExecutable}" failonerror="true"  >
            <arg line="-f ${rpmBase}/access-service-${version}-${release}.noarch.rpm -r ${repository}"/>
        </exec>-->
    </target>

</project>